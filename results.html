<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Results | Root Values Survey</title>

  <link rel="stylesheet" href="styles.css" />
  <script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
</head>
<body>
  <div class="container">
    <p class="topnav"><a href="index.html">← Back to Home</a></p>

    <div class="hero">
      <h1>Results — Root Values Survey</h1>
      <p class="lead" id="lead">Loading results…</p>
    </div>

    <div class="card">
      <div id="aggregate-plot" style="height:520px;"></div>
    </div>

    <footer>
      <p>© 2025 UCD Digital Society | MIS20070 Group Project</p>
    </footer>
  </div>

<script>
(async () => {
  const ENDPOINT_URL = "https://script.google.com/macros/s/AKfycbwhSuxpukigN3ZVXeYPL9JeRh7UWHr_O87BpR2hVpX_W74h21C25NHwtfs1rPELoToLdA/exec";
  const leadEl = document.getElementById('lead');

  const mean = arr => arr.reduce((a,b)=>a+b,0)/arr.length;
  const norm = ({a,b,c}) => {
    const s = (a||0)+(b||0)+(c||0);
    return s>0 ? {a:(a||0)/s, b:(b||0)/s, c:(c||0)/s} : {a:0,b:0,c:0};
  };

  // Fetch CSV data
  let csvText;
  try {
    const res = await fetch(ENDPOINT_URL, { cache: "no-store" });
    csvText = await res.text();
  } catch (e) {
    leadEl.textContent = "⚠️ Could not load data (network issue).";
    return;
  }

  // Parse CSV
  const parsed = Papa.parse(csvText, { header: true, dynamicTyping: true, skipEmptyLines: true });
  const rows = parsed.data.filter(r =>
    Number.isFinite(r.today_a) &&
    Number.isFinite(r.today_b) &&
    Number.isFinite(r.today_c) &&
    Number.isFinite(r.y2075_a) &&
    Number.isFinite(r.y2075_b) &&
    Number.isFinite(r.y2075_c)
  );

  if (!rows.length) {
    leadEl.textContent = "⚠️ No valid rows found. Check column names in the sheet.";
    return;
  }

  // Extract and normalise
  const tA = [], tB = [], tC = [], fA = [], fB = [], fC = [];
  for (const r of rows) {
    const today = norm({ a:r.today_a, b:r.today_b, c:r.today_c });
    const future = norm({ a:r.y2075_a, b:r.y2075_b, c:r.y2075_c });
    tA.push(today.a); tB.push(today.b); tC.push(today.c);
    fA.push(future.a); fB.push(future.b); fC.push(future.c);
  }

  // Calculate averages
  const avgToday  = { a: mean(tA), b: mean(tB), c: mean(tC) };
  const avgFuture = { a: mean(fA), b: mean(fB), c: mean(fC) };

  // Plotly chart
  const traces = [
    {
      type: 'scatterternary',
      mode: 'markers',
      name: 'Today (2025) — individuals',
      a: tA, b: tB, c: tC,
      marker: { size: 6, color: '#6ee7ff', opacity: 0.35 },
      hoverinfo: 'none'
    },
    {
      type: 'scatterternary',
      mode: 'markers',
      name: 'Future (2075) — individuals',
      a: fA, b: fB, c: fC,
      marker: { size: 6, color: '#a78bfa', opacity: 0.35 },
      hoverinfo: 'none'
    },
    {
      type: 'scatterternary',
      mode: 'markers+text',
      name: 'Averages',
      a: [avgToday.a, avgFuture.a],
      b: [avgToday.b, avgFuture.b],
      c: [avgToday.c, avgFuture.c],
      text: ['Today (2025)', 'Future (2075)'],
      textposition: 'top center',
      marker: { size: 12, color: ['#6ee7ff', '#a78bfa'], line: { color: '#fff', width: 2 } }
    }
  ];

  const layout = {
    title: 'Balance of Autonomy, Knowledge Integrity, and Equ
